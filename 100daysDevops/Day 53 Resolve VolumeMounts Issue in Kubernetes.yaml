Day 53 Resolve VolumeMounts Issue in Kubernetes

We encountered an issue with our Nginx and PHP-FPM setup on the Kubernetes cluster this morning, which halted its functionality. Investigate and rectify the issue:



The pod name is nginx-phpfpm and configmap name is nginx-config. Identify and fix the problem.


Once resolved, copy /home/thor/index.php file from the jump host to the nginx-container within the nginx document root. After this, you should be able to access the website using Website button on the top bar.


Note: The kubectl utility on jump_host is configured to operate with the Kubernetes cluster.


Solution:

#configmap volume  Mount issue

kubectl get configmap
kubectl describe configmap nginx-config

#check pod status and can see two container mount path are not same
kubectl get pod nginx-phpfpm
kubectl describe pod nginx-phpfpm

#this path has to be mount
/var/www/html

#edit pod
kubectl edit pod nginx-phpfpm

In php-fpm container
volumeMounts:
- name: nginx-config-volume

kubectl apply -f /tmp/kubectl-edit-2386622890.yaml --force

kubectl get pod nginx-phpfpm


#copy thor to pod -c is copy to nginx container
kubectl cp /home/thor/index.php nginx-phpfpm:/var/www/html -c nginx-container

#verify
kubectl exec -it nginx-phpfpm -c nginx-container -- sh
cd /var/www/html